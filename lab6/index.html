<!DOCTYPE html>
<html>

<head>
    <title>D3.js Demo</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.js"
        integrity="sha512-NmSTfudjn1FCaFMQ+f4xveBmwRJn5ep8Wu+YOeq+CeExhFtKvwhfKVXFX3tGxoGWxu8Fl83qm9nE8/Hkc1dWZg=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://code.jquery.com/jquery-3.1.0.min.js"></script>
    <meta charset="UTF-8">
    <style type="text/css"></style>
</head>

<style>
    .line {
        fill: none;
        stroke: steelblue;
        stroke-width: 1.5px;
    }
</style>

<body>
    <h1>Ivona Cvija</h1>
    <script type="text/javascript">
        // Retrieve the JSON data
        $.getJSON("https://pkgstore.datahub.io/core/co2-ppm/co2-mm-mlo_json/data/aed7eb0d19cbcd90790525d40728b0a8/co2-mm-mlo_json.json", function (data) {
            console.log(data);
            plotCO2Data(data);
        });

        // Execute once the file has downloaded
        function plotCO2Data(data) {
            // Set up SVG size and margins
            var margin = { top: 50, right: 50, bottom: 50, left: 50 },
                width = 900 - margin.left - margin.right,
                height = 670 - margin.top - margin.bottom;

            // Create x and y scales for interpolated value (x-axis) and time
            var y = d3.scaleLinear()
                // Atmospheric CO2 values
                .domain(d3.extent(data, function (d) { return d["Interpolated"] }))
                // Seems backward because SVG y is down
                .range([height, 0]);

            //create x and y scales for trend value (x-axis) 
            var trendY = d3.scaleLinear()
                .domain(d3.extent(data, function (d) { return d["Trend"] }))
                //svg is down
                .range([height, 0]);

            //create x and y scales for trend value (x-axis) 
            var tempY = d3.scaleLinear()
                .domain(d3.extent(data, function (d) { return d["Average"] }))
                //svg is down
                .range([height, 0]);

            //parse the date / time
            var parseDate = d3.timeParse("%Y-%m-%d"); // Converts string to a date object day/month/year

            var x = d3.scaleTime()
                .domain(d3.extent(data, function (d) { return parseDate(d["Date"]); }))
                .range([0, width]);

            //axis x is the d3.scaleTime()
            var xAxis = d3.axisBottom(x)
                .ticks(d3.timeYear.every(5)); // Adjust the tick frequency as needed

            //axis y is the d3.scaleLinear

            var yAxis = d3.axisLeft(y)
                .ticks(3);

            //variable for the brush
            var brush = d3.brushX()
                .extent([[0, 0], [width, height]])
                .on("brush end", brushed);

            // draw line - maps x, y coordinates for each data point, using x,y scale functions
            var valueline = d3.line()
                // x and y pixels for each data point
                .x(function (d) { return x(parseDate(d["Date"])); })
                .y(function (d) { return y(d["Interpolated"]); });

            //add trend line
            var trendvalueline = d3.line()
                .x(function (d) { return x(parseDate(d["Date"])); }) // x pixel for each data point
                .y(function (d) { return trendY(d["Trend"]); }); // y pixel for each data point

            //add trend line
            var tempvalueline = d3.line()
                .x(function (d) { return x(parseDate(d["Date"])); }) // x pixel for each data point
                .y(function (d) { return tempY(d["Average"]); }); // y pixel for each data point

            var svg = d3.select('body')
                .append("svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
                .append("g")

            // // Define the zoom function for x-axis and lines
            // var zoomX = d3.zoom()
            //     .scaleExtent([1, Infinity])
            //     .translateExtent([[0, 0], [width, height]])
            //     .extent([[0, 0], [width, height]])
            //     .on("zoom", zoomedX);

            // // Apply the zoom behavior to the SVG element for x-axis and lines
            // svg.append("rect")
            //     .attr("class", "zoom")
            //     .attr("width", width)
            //     .attr("height", height)
            //     .attr("transform", "translate(" + margin.left + "," + margin.top + ")")
            //     .call(zoomX)
            //     .style("fill", "none")
            //     .style("pointer-events", "all");

            //add the axes to the element
            svg.append('g')//append a <g> - group element
                .attr('class', 'x axis')
                .attr('transform', 'translate(0, ' + height + ')')
                .call(xAxis);//let the axis do its thing

            svg.append('g')
                .attr('class', 'y axis')//specify classes
                .call(yAxis);

            //trend y axis
            svg.append('g')
                .attr('class', 'y axis trend line')
                .attr('transform', 'translate(' + width + ', 0')
                .call(trendY);

            //add the labels
            // x-axis label
            svg.append('text')
                .attr('class', 'x label')
                .attr('text-anchor', 'end')
                .attr('x', width)
                .attr('y', height + margin.top + 40)
                .text('Date');

            //y-axis label
            svg.append('text')
                .attr('class', 'y label')
                .attr('text-anchor', 'end')
                .attr('y', -margin.left + 15)
                .attr('x', -margin.top - 100)
                .attr('dy', '.75em')
                .attr('transform', 'rotate(-90)')
                .text('CO2 Concentration (ppm)');

            //chart label
            svg.append('text')
                .attr('class', 'chart label')
                .attr('x', width / 2)
                .attr('y', -margin.top / 2)
                .attr('text-anchor', 'middle')
                .style('font-size', '1.5em') // Increase font size
                .text('CO2 Concentration Over Time');

            //add the valueline path
            svg.append("path")
                .attr("d", valueline(data))
                .attr("fill", "none")
                .attr("stroke", "red");

            //add the trendvalueline path
            svg.append("path")
                .attr("d", trendvalueline(data))
                .attr("fill", "none")
                .attr("stroke", "blue");

            // // Define the zoomed function for x-axis and lines
            // function zoomedX(event) {
            //     var new_xScale = event.transform.rescaleX(x);
            //     svg.select(".x.axis").call(xAxis.scale(new_xScale));

            //     // Update the paths with the new x and y scales
            //     svg.selectAll(".line").attr("d", function (d) {
            //         return valueline(data.map(function (point) {
            //             return {
            //                 "Date": point["Date"],
            //                 "Interpolated": new_xScale(parseDate(point["Date"])),
            //                 "Trend": trendY(point["Trend"]),
            //                 "Average": tempY(point["Average"])
            //             };
            //         }));
            //     });
            // }

            function brushed() {
                if (d3.event.sourceEvent && d3.event.sourceEvent.type === "zoom") return; // ignore brush-by-zoom
                var s = d3.event.selection || x.range();
                x.domain(s.map(x.invert, x));
                svg.select(".x.axis").attr("d", valueline);
                focus.select(".axis--x").call(xAxis);
                svg.select(".zoom").call(zoom.transform, d3.zoomIdentity
                    .scale(width / (s[1] - s[0]))
                    .translate(-s[0], 0));
            }

        }
    </script>
</body>

</html>